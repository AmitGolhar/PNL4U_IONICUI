<ion-header>
  <ion-toolbar color="dark">
    <ion-title>Nightlife Feed</ion-title>
  </ion-toolbar>

  <!-- Filter toolbar: search + segment -->
  <ion-toolbar class="filter-toolbar">
    <div class="filter-row">
      <ion-searchbar
        class="custom-search"
        placeholder="Search by city..."
        (ionChange)="applyFilters('city', $event.detail.value)">
      </ion-searchbar>

      <div class="segment-wrap">
        <ion-segment
          value="trendingScore"
          (ionChange)="applyFilters('sortBy', $event.detail.value)">
          <ion-segment-button value="trendingScore">
            <ion-label>Trending</ion-label>
          </ion-segment-button>
          <ion-segment-button value="rating">
            <ion-label>Rating</ion-label>
          </ion-segment-button>
          <ion-segment-button value="popularityScore">
            <ion-label>Popular</ion-label>
          </ion-segment-button>
        </ion-segment>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <!-- üîÑ Pull to Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="onRefresh($event)">
    <ion-refresher-content
      pullingIcon="chevron-down-circle-outline"
      refreshingSpinner="bubbles"
      pullingText="Pull down to refresh..."
      refreshingText="Refreshing feed...">
    </ion-refresher-content>
  </ion-refresher>

  <!-- ‚è≥ Loader -->
  <ion-spinner *ngIf="loading && page === 0" name="crescent" class="spinner-center"></ion-spinner>

  <!-- üèôÔ∏è Club Feed -->
  <ion-grid *ngIf="!loading || clubs.length > 0">
    <ion-row>
      <ion-col size="12" *ngFor="let club of clubs">
        <ion-card class="club-card" (click)="openClubDetail(club.clubId)">

          <ion-img
            *ngIf="club.imagesBase64?.length"
            [src]="club.imagesBase64[0]"
            alt="{{ club.clubName }}">
          </ion-img>

          <ion-card-header>
            <ion-card-title>
              {{ club.clubName }}
              <ion-icon
                *ngIf="club.verified"
                name="checkmark-circle-outline"
                color="success">
              </ion-icon>
            </ion-card-title>
            <ion-card-subtitle>{{ club.city }} ‚Ä¢ {{ club.category }}</ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            <p class="club-desc">{{ club.description }}</p>

            <!-- üéµ Genres & Crowd -->
            <div class="club-tags">
              <p *ngIf="club.genre?.length">
                <strong>üé∂ Genres:</strong> {{ club.genre.join(', ') }}
              </p>
              <p *ngIf="club.crowdType?.length">
                <strong>üë• Crowd:</strong> {{ club.crowdType.join(', ') }}
              </p>
            </div>

            <!-- üçπ Happy Hours -->
            <p *ngIf="club.hasHappyHours" class="happy-hour">
              üçπ <strong>Happy Hours Active</strong> ‚Äî Check offers before 9 PM!
            </p>

            <!-- ‚≠ê Rating and Trend -->
            <div class="rating-trend">
              <div class="rating">
                ‚≠ê {{ club.rating || 0 }} / 5
              </div>
              <div class="trend-score" *ngIf="club.trendingScore">
                üî• Trend: {{ club.trendingScore | number:'1.0-0' }} pts
              </div>
            </div>

            <!-- üé´ Actions -->
            <div class="club-actions">
              <ion-button fill="outline" size="small" class="pink-outline" (click)="bookTable(club)">
                <ion-icon name="wine-outline" slot="start"></ion-icon>
                Book Table
              </ion-button>

              <ion-button fill="outline" size="small" class="pink-outline" (click)="bookGuestList(club)">
                <ion-icon name="people-outline" slot="start"></ion-icon>
                Add Guest List
              </ion-button>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- üåÄ Infinite Scroll -->
  <ion-infinite-scroll
    threshold="100px"
    (ionInfinite)="loadMore($event)"
    [disabled]="page + 1 >= totalPages">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="Loading more clubs...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>

  <!-- ‚ö†Ô∏è No Data -->
  <ion-item *ngIf="!loading && clubs.length === 0" lines="none">
    <ion-label>No clubs found</ion-label>
  </ion-item>

</ion-content>
