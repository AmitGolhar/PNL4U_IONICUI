<ion-header>
  <ion-toolbar color="dark">
    <ion-title>Nightlife Feed</ion-title>
  </ion-toolbar>

  <!-- Filter toolbar -->
  <ion-toolbar class="filter-toolbar">
    <div class="filter-row">
      <!-- üåÜ City Filter -->
      <ion-item class="dropdown-item city-filter" lines="none">
        <ion-label position="stacked">City</ion-label>
        <ion-select interface="popover" [(ngModel)]="selectedCity"
          [placeholder]="selectedCity ? selectedCity : 'Select City'"
          (ionChange)="applyFilters('city', $event.detail.value)">
          <ion-select-option *ngFor="let c of cities" [value]="c">
            {{ c }}
          </ion-select-option>
        </ion-select>
      </ion-item>


      <!-- üç∏ Club Type Filter -->
      <ion-item class="dropdown-item club-type-filter" lines="none">
        <ion-label position="stacked">Club Type</ion-label>
        <ion-select placeholder="Select Club Type" interface="popover"
          (ionChange)="applyFilters('clubType', $event.detail.value)">
          <ion-select-option *ngFor="let type of clubTypes" [value]="type">
            {{ type }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      <!-- üéµ Genres Filter -->
      <ion-item class="dropdown-item genre-filter" lines="none">
        <ion-label position="stacked">Genres</ion-label>
        <ion-select placeholder="Select Genre" interface="popover"
          (ionChange)="applyFilters('genre', $event.detail.value)">
          <ion-select-option *ngFor="let genre of eventGenres" [value]="genre.value">
            {{ genre.label }}
          </ion-select-option>
        </ion-select>
      </ion-item>


    </div>
  </ion-toolbar>
</ion-header>



<ion-content [fullscreen]="true">

  <!-- üîÑ Pull to Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="onRefresh($event)">
    <ion-refresher-content pullingIcon="chevron-down-circle-outline" refreshingSpinner="bubbles"
      pullingText="Pull down to refresh..." refreshingText="Refreshing feed...">
    </ion-refresher-content>
  </ion-refresher>

  <!-- ‚è≥ Loader -->
  <ion-spinner *ngIf="loading && page === 0" name="crescent" class="spinner-center"></ion-spinner>

  <!-- üèôÔ∏è Club Feed -->
  <ion-grid *ngIf="!loading || clubs.length > 0">
    <ion-row>
      <ion-col size="12" *ngFor="let club of clubs">
        <ion-card class="club-card" (click)="openClubDetail(club.clubId)">

          <ion-img *ngIf="club.imagesBase64?.length" [src]="club.imagesBase64[0]" alt="{{ club.clubName }}">
          </ion-img>

          <ion-card-header>
            <ion-card-title>
              {{ club.clubName }}
              <ion-icon *ngIf="club.verified" name="checkmark-circle-outline" color="success">
              </ion-icon>
            </ion-card-title>
            <ion-card-subtitle>{{ club.city }} </ion-card-subtitle>
            <!-- Club Category Chips -->


          </ion-card-header>

          <ion-card-content>
            <p class="club-desc">üìç {{ club.address }}</p>
            <p class="club-desc">{{ club.description }}</p>

            <!-- üéµ Genres & Crowd -->
            <div class="club-tags">
              <ion-chip color="primary" *ngFor="let cat of club.category?.split(',')">
                {{ cat }}
              </ion-chip>

              <p *ngIf="club.genre?.length">
                <strong>üé∂ Genres:</strong> {{ club.genre.join(', ') }}
              </p>
              <p *ngIf="club.crowdType?.length">
                <strong>üë• Crowd:</strong> {{ club.crowdType.join(', ') }}
              </p>
            </div>

            <!-- üçπ Happy Hours -->
            <p *ngIf="club.hasHappyHours" class="happy-hour">
              üçπ <strong>Happy Hours Active</strong> ‚Äî Check offers before 9 PM!
            </p>

            <!-- ‚≠ê Rating and Trend -->

            <!-- <div class="rating-trend">
              <div class="rating">
                ‚≠ê {{ club.rating || 0 }} / 5
              </div>
              <div class="trend-score" *ngIf="club.trendingScore">
                üî• Trend: {{ club.trendingScore | number:'1.0-0' }} pts
              </div>
            </div> -->

            <ion-button fill="solid" size="small" class="see-more-btn" (click)="viewClubDetails(club)">
              <ion-icon name="information-circle-outline" slot="start"></ion-icon>
              See More Details
            </ion-button>

          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- üåÄ Infinite Scroll -->
  <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMore($event)" [disabled]="page + 1 >= totalPages">
    <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Loading more clubs...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>

  <!-- ‚ö†Ô∏è No Data -->
  <ion-item *ngIf="!loading && clubs.length === 0" lines="none">
    <ion-label>No clubs found</ion-label>
  </ion-item>

</ion-content>