<ion-header translucent>
  <ion-toolbar color="dark">
    <ion-title>Create Event</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding create-event-bg">
  <form [formGroup]="eventForm" (ngSubmit)="submitEvent()">

    <!-- üéâ Event Details -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Event Details</ion-card-title>
      </ion-card-header>

      <ion-card-content>

        <ion-item>
          <ion-label position="stacked">Event Name</ion-label>
          <ion-input placeholder="e.g. Bollywood Night Fever" formControlName="eventName"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Description</ion-label>
          <ion-textarea formControlName="description" autoGrow="true" placeholder="Describe your event"></ion-textarea>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Banner Type</ion-label>
          <ion-select formControlName="bannerType" interface="alert" multiple="true" placeholder="Select Banner Types"
            cssClass="pink-alert">
            <ion-select-option value="FEATURED_EVENT">Featured Event</ion-select-option>
            <ion-select-option value="CLUB_VENUE_HIGHLIGHT">Club / Venue Highlight</ion-select-option>
            <ion-select-option value="LIMITED_TIME_OFFER">Limited-Time Offer</ion-select-option>
            <ion-select-option value="ARTIST_DJ_LINEUP">Artist / DJ Lineup</ion-select-option>
            <ion-select-option value="THEME_NIGHT">Theme Night</ion-select-option>
            <ion-select-option value="UPCOMING_EVENTS">Upcoming Events</ion-select-option>
            <ion-select-option value="SPONSORED_EVENT">Sponsored / Partner Event</ion-select-option>
            <ion-select-option value="LOCATION_BASED">Location-Based Recommendation</ion-select-option>
            <ion-select-option value="VIP_EXCLUSIVE_ACCESS">VIP / Exclusive Access</ion-select-option>
            <ion-select-option value="NEW_LAUNCH_ANNOUNCEMENT">New Launch / Announcement</ion-select-option>
          </ion-select>
        </ion-item>


        <!-- ‚úÖ Multi-select Categories -->
        <ion-item>
          <ion-label position="stacked">Categories</ion-label>
          <ion-select formControlName="category" interface="alert" multiple="true" placeholder="Select Categories"
            cssClass="pink-alert">
            <ion-select-option *ngFor="let cat of eventCategories" [value]="cat.value">
              {{ cat.label }}
            </ion-select-option>
          </ion-select>
        </ion-item>


        <ion-item>
          <ion-label position="stacked">Sub Category</ion-label>
          <ion-select formControlName="subCategory" interface="alert" multiple="true"
            placeholder="Select Sub Categories" cssClass="pink-alert">
            <ion-select-option *ngFor="let sub of eventSubCategories" [value]="sub.value">
              {{ sub.label }}
            </ion-select-option>
          </ion-select>
        </ion-item>



        <!-- ‚úÖ Multi-select Genres -->
        <ion-item>
          <ion-label position="stacked">Genres</ion-label>
          <ion-select formControlName="genre" multiple="true" interface="alert" placeholder="Select Genres"
            cssClass="pink-alert">
            <ion-select-option *ngFor="let genre of eventGenres" [value]="genre.value">
              {{ genre.label }}
            </ion-select-option>
          </ion-select>
        </ion-item>


        <ion-item>
          <ion-label position="stacked">Tags</ion-label>
          <ion-input placeholder="e.g. Dance, Fun, Weekend" formControlName="tags"></ion-input>
        </ion-item>

        <!-- üìç Location -->
        <ion-item>
          <ion-label position="stacked">City</ion-label>
          <ion-input placeholder="e.g. Pune" formControlName="locationCity"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Venue Name</ion-label>
          <ion-input placeholder="e.g. The Night Owl Club" formControlName="venueName"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Latitude</ion-label>
          <ion-input type="number" formControlName="latitude"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Longitude</ion-label>
          <ion-input type="number" formControlName="longitude"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Start Date</ion-label>
          <ion-input type="date" formControlName="startDate"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">End Date</ion-label>
          <ion-input type="date" formControlName="endDate"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Start Time</ion-label>
          <ion-input type="time" formControlName="startTime"></ion-input>
        </ion-item>



        <ion-item>
          <ion-label position="stacked">Duration</ion-label>
          <ion-input placeholder="e.g. 5 hours" formControlName="duration"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Artist(s)</ion-label>
          <ion-input placeholder="e.g. DJ Roxy, DJ Blaze" formControlName="artistName"></ion-input>
        </ion-item>


        <ion-item>
          <ion-label position="stacked">Event Type</ion-label>
          <ion-select formControlName="eventType" interface="alert" (ionChange)="onEventTypeChange($event)"
            placeholder="Select Event Type" cssClass="pink-alert">
            <ion-select-option *ngFor="let type of eventTypes" [value]="type.value">
              {{ type.label }}
            </ion-select-option>
          </ion-select>
        </ion-item>




        <!-- üéö Toggles -->
        <ion-item>
          <ion-label>Free Entry</ion-label>
          <ion-toggle formControlName="isFreeEntry"></ion-toggle>
        </ion-item>

        <ion-text color="warning" *ngIf="eventForm.get('eventType')?.value === 'PAID'">
          <small>‚ö†Ô∏è Free Entry is disabled for paid events.</small>
        </ion-text>

        <ion-text color="success" *ngIf="eventForm.get('eventType')?.value === 'FREE'">
          <small>‚úÖ Free Entry automatically enabled for free events.</small>
        </ion-text>


        <ion-item>
          <ion-label>Weekend Event</ion-label>
          <ion-toggle formControlName="isWeekend"></ion-toggle>
        </ion-item>

        <ion-item>
          <ion-label>Offers Available</ion-label>
          <ion-toggle formControlName="hasOffers"></ion-toggle>
        </ion-item>

        <ion-item *ngIf="eventForm.get('hasOffers')?.value">
          <ion-label position="stacked">Offer Details</ion-label>
          <ion-input placeholder="e.g. Buy 1 Get 1 on Drinks" formControlName="offers"></ion-input>
        </ion-item>

        <!-- üë• Crowd & Policies -->
        <ion-item>
          <ion-label position="stacked">Crowd Type</ion-label>
          <ion-select formControlName="crowdType" multiple="true" interface="alert" placeholder="Select Crowd Type"
            cssClass="pink-alert">
            <ion-select-option *ngFor="let crowd of eventCrowdTypes" [value]="crowd.value">
              {{ crowd.label }}
            </ion-select-option>
          </ion-select>
        </ion-item>


        <ion-item>
          <ion-label position="stacked">Entry Policy</ion-label>
          <ion-input placeholder="e.g. Couples Only" formControlName="entryPolicy"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Dress Code</ion-label>
          <ion-select formControlName="dressCode" multiple="true" interface="alert" placeholder="Select Dress Codes"
            cssClass="pink-alert">
            <ion-select-option *ngFor="let dress of eventDressCodes" [value]="dress.value">
              {{ dress.label }}
            </ion-select-option>
          </ion-select>
        </ion-item>


        <ion-item>
          <ion-label position="stacked">Refund Policy</ion-label>
          <ion-input placeholder="e.g. Non-refundable tickets" formControlName="refundPolicy"></ion-input>
        </ion-item>

        <!-- üßí Friendly Options -->
        <ion-item>
          <ion-label position="stacked">Kids Friendly</ion-label>
          <ion-select formControlName="kidsFriendly" interface="popover">
            <ion-select-option>No</ion-select-option>
            <ion-select-option>Yes</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Pets Friendly</ion-label>
          <ion-select formControlName="petsFriendly" interface="popover">
            <ion-select-option>No</ion-select-option>
            <ion-select-option>Yes</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Indoor / Outdoor</ion-label>
          <ion-select formControlName="indoorOrOutdoor" interface="popover">
            <ion-select-option>Indoor</ion-select-option>
            <ion-select-option>Outdoor</ion-select-option>
            <ion-select-option>Both</ion-select-option>
          </ion-select>
        </ion-item>

        <!-- üì∏ Flyer Upload -->
        <ion-item lines="none" class="flyer-upload">
          <ion-label position="stacked">Flyer Image (Max 2 MB)</ion-label>

          <!-- Hidden file input -->
          <input type="file" id="flyerUpload" (change)="onFlyerSelected($event)" accept="image/*" hidden />

          <!-- Fancy Upload Button -->
          <ion-button expand="block" color="warning" fill="solid" (click)="triggerFlyerUpload()">
            <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
            Choose Flyer
          </ion-button>
        </ion-item>

        <!-- ‚úÖ Flyer Preview -->
        <div class="flyer-preview" *ngIf="flyerPreview">
          <ion-card>
            <img [src]="flyerPreview" alt="Flyer Preview" />
            <ion-card-content class="ion-text-center">
              <ion-text color="medium">Preview</ion-text>
            </ion-card-content>
            <div class="ion-text-center">
              <ion-button color="danger" fill="clear" size="small" (click)="removeFlyer()">
                <ion-icon name="trash-outline" slot="start"></ion-icon>
                Remove Flyer
              </ion-button>
            </div>
          </ion-card>
        </div>


      </ion-card-content>
    </ion-card>

    <!-- üéü Ticket Section -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Tickets</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <div formArrayName="tickets">
          <div *ngFor="let t of tickets.controls; let i = index" [formGroupName]="i" class="ticket-box">
            <ion-item>
              <ion-label position="stacked">Ticket Name</ion-label>
              <ion-input formControlName="name"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="stacked">Price (‚Çπ)</ion-label>
              <ion-input type="number" formControlName="price"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="stacked">Quantity</ion-label>
              <ion-input type="number" formControlName="quantity"></ion-input>
            </ion-item>
            <ion-button color="danger" fill="clear" (click)="removeTicket(i)">Remove</ion-button>
          </div>
        </div>
        <ion-button expand="block" color="warning" (click)="addTicket()">
          <ion-icon name="add-circle" slot="start"></ion-icon>
          Add Ticket
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- ‚úÖ Submit -->
    <ion-button expand="block" type="submit" [disabled]="submitting" color="success">
      <ion-spinner *ngIf="submitting" slot="start"></ion-spinner>
      Create New Event
    </ion-button>

  </form>
</ion-content>